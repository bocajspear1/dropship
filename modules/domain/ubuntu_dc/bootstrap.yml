- name: Wait for server to come online
  become: no
  delegate_to: localhost
  wait_for:
    host: "{{ ansible_host }}"
    port: 22
- name: Write the host key to known hosts
  delegate_to: localhost
  shell: "ssh-keyscan -H {{ ansible_host }} >> ~/.ssh/known_hosts"
  become: no
- name: test
  shell: "whoami > /tmp/hello"
- name: Update the server cache
  apt: 
    update_cache: yes
- name: Update the server packages
  apt: 
    upgrade: dist
- name: Install required packages
  apt:
    pkg:
    - samba 
    - krb5-user 
    - krb5-config 
    - winbind 
    - libpam-winbind 
    - libnss-winbind
    update_cache: yes
- name: Set server hostname
  shell: "hostnamectl set-hostname {{ inventory_hostname }}"
- name: Set a static IP using netplan
  template:
    src: +TEMPLATES+/netplan.yml
    dest: /etc/netplan/01-netcfg.yaml
- name: Reboot server
  shell: 'sleep 2 && shutdown -r now'
  poll: 0
  async: 1
  
    
    